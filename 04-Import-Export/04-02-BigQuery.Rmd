---
title: "BigQuery Connection"
output: html_notebook
---

Firs, we need to install the package `bigquery`. Like other packages, this needs to be done only once for each environment. Run the following code in your console to install this package:

```
install.packages("bigrquery")
```

Next we will load the package and provide the "billing". Billing here is your GCP project ID, **replace ba-780 with your own project ID**:

```{r}
library(bigrquery)
options(gargle_oob_default=TRUE)

billing <- 'ba-780' # replace this with your project ID 
```

We can then create the query we would like to run and store it in an object. We can pick any name, here we are using "sql":

```{r}
sql <- "
SELECT year, is_male, count(*) FROM `bigquery-public-data.samples.natality`
GROUP BY year, is_male
ORDER BY year ASC
"
```

## Submit query to BigQuery
We now will submit a job, the "sql" query we wrote above, to BigQuery. 

**Note:** When you interact with BigQuery for the first time you will have to go through the authentication process. A window in a browser will pop up, select the appropriate account, give permissions and at the last stage copy the given token and paste it to the console. This token will be saved and there will be no need to redo this process in the future.

Let's run our query:

```{r}
tb <- bq_project_query(billing, sql)
```

Download table data

```{r}
bq_table_download(tb, max_results = 10)
```

